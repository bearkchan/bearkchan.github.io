---
title: "Javaä¸­å¤šçº¿ç¨‹çš„ä½¿ç”¨"
date: 2021-03-13T03:01:11+08:00
lastmod: 2021-03-13T03:01:11+08:00
draft: false
tags: ["java", "é”", "åŒæ­¥", "å¤šçº¿ç¨‹"]
categories: ["java"]

# You can also close(false) or open(true) something for this content.
# P.S. comment can only be closed
comment: false
toc: false
autoCollapseToc: false
postMetaInFooter: false
hiddenFromHomePage: false
# You can also define another contentCopyright. e.g. contentCopyright: "This is another copyright."
contentCopyright: false
reward: false
mathjax: false
mathjaxEnableSingleDollar: false
mathjaxEnableAutoNumber: false

# You unlisted posts you might want not want the header or footer to show
hideHeaderAndFooter: false

# You can enable or disable out-of-date content warning for individual post.
# Comment this out to use the global config.
#enableOutdatedInfoWarning: false

flowchartDiagrams:
  enable: false
  options: ""

sequenceDiagrams: 
  enable: false
  options: ""

---

<!--more-->

## 1. ç¨‹åºã€è¿›ç¨‹ã€çº¿ç¨‹çš„ç†è§£

### 1.1 ç¨‹åºï¼ˆprogramï¼‰

æ˜¯ä¸ºå®Œæˆç‰¹å®šä»»åŠ¡ã€ç”¨æŸç§è¯­è¨€ç¼–å†™çš„ä¸€ç»„æŒ‡ä»¤çš„é›†åˆã€‚å³æŒ‡**ä¸€æ®µé™æ€çš„ä»£ç **ã€‚

### 1.2 è¿›ç¨‹ï¼ˆprocessï¼‰

ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ–æ˜¯**æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªç¨‹åº**ã€‚

> è¿›ç¨‹ä½œä¸º**èµ„æºåˆ†é…çš„å•ä½**ï¼Œç³»ç»Ÿåœ¨è¿è¡Œæ—¶ä¼šä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸åŒçš„å†…å­˜åŒºåŸŸã€‚

### 1.3 çº¿ç¨‹ï¼ˆthreadï¼‰

è¿›ç¨‹å¯è¿›ä¸€æ­¥ç»†åŒ–ä¸ºçº¿ç¨‹ï¼Œæ˜¯ä¸€ä¸ªç¨‹åºå†…éƒ¨çš„ä¸€æ¡æ‰§è¡Œè·¯å¾„ã€‚

> **çº¿ç¨‹ä½œä¸ºè°ƒåº¦å’Œæ‰§è¡Œçš„å•ä½ï¼Œæ¯ä¸ªçº¿ç¨‹æ‹¥ç‹¬ç«‹çš„è¿è¡Œæ ˆå’Œç¨‹åºè®¡æ•°å™¨(pc)**ï¼Œçº¿ç¨‹åˆ‡æ¢çš„å¼€é”€å°ã€‚

![img](http://cdn.bearkchan.top/img1.jpg)

### 1.4 è¡¥å……

å†…å­˜ç»“æ„å›¾ï¼š

![image-20210313134552419](http://cdn.bearkchan.top/image-20210313134552419.png)

è¿›ç¨‹å¯ä»¥ç»†åŒ–ä¸ºå¤šä¸ªçº¿ç¨‹ã€‚

æ¯ä¸ªçº¿ç¨‹ï¼Œæ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ï¼šæ ˆã€ç¨‹åºè®¡æ•°å™¨ã€‚

å¤šä¸ªçº¿ç¨‹ï¼Œå…±äº«åŒä¸€ä¸ªè¿›ç¨‹çš„ç»“æ„ï¼šæ–¹æ³•åŒºã€å †ã€‚

## 2. å¹¶è¡Œä¸å¹¶å‘

### 2.1 å•æ ¸CPUä¸å¤šæ ¸CPUçš„ç†è§£

- **å•æ ¸CPU**å…¶å®æ˜¯ä¸€ç§å‡çš„å¤šçº¿ç¨‹ï¼Œå› ä¸ºåœ¨ä¸€ä¸ªæ—¶é—´å•å…ƒå†…ï¼Œä¹Ÿåªèƒ½æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹çš„ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼šè™½ç„¶æœ‰å¤šè½¦é“ï¼Œä½†æ˜¯æ”¶è´¹ç«™åªæœ‰ä¸€ä¸ªå·¥ä½œäººå‘˜åœ¨æ”¶è´¹ï¼Œåªæœ‰æ”¶äº†è´¹æ‰èƒ½é€šè¿‡ï¼Œé‚£ä¹ˆCPUå°±å¥½æ¯”æ”¶è´¹äººå‘˜ã€‚å¦‚æœæŸä¸ªäººä¸æƒ³äº¤é’±ï¼Œé‚£ä¹ˆæ”¶è´¹äººå‘˜å¯ä»¥æŠŠä»–â€œæŒ‚èµ·â€ï¼ˆæ™¾ç€ä»–ï¼Œç­‰ä»–æƒ³é€šäº†ï¼Œå‡†å¤‡å¥½äº†é’±ï¼Œå†å»æ”¶è´¹ã€‚ï¼‰ä½†æ˜¯å› ä¸ºCPUæ—¶é—´å•å…ƒç‰¹åˆ«çŸ­ï¼Œå› æ­¤æ„Ÿè§‰ä¸å‡ºæ¥ã€‚

- å¦‚æœæ˜¯å¤šæ ¸çš„è¯ï¼Œæ‰èƒ½æ›´å¥½çš„å‘æŒ¥å¤šçº¿ç¨‹çš„æ•ˆç‡ã€‚ï¼ˆç°åœ¨çš„æœåŠ¡å™¨éƒ½æ˜¯å¤šæ ¸çš„ï¼‰

### 2.2 å¹¶è¡Œå’Œå¹¶å‘çš„ç†è§£

- å¹¶è¡Œï¼šå¤šä¸ªCPUåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚æ¯”å¦‚ï¼šå¤šä¸ªäººåŒæ—¶åšä¸åŒçš„äº‹æƒ…ã€‚
- å¹¶å‘ï¼šä¸€ä¸ªCPUï¼ˆé‡‡ç”¨æ—¶é—´ç‰‡ï¼‰åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚æ¯”å¦‚ï¼šç§’æ€ã€å¤šä¸ªäººåšåŒä¸€ä»¶äº‹ã€‚

## 3. åˆ›å»ºå¤šçº¿ç¨‹çš„ä¸¤ç§æ–¹å¼

### 3.1 æ–¹å¼ä¸€ï¼šç»§æ‰¿Threadç±»çš„æ–¹å¼

1. åˆ›å»ºä¸€ä¸ªç»§æ‰¿äºThreadç±»çš„å­ç±»

2. é‡å†™Threadç±»çš„run() -->å°†æ­¤çº¿ç¨‹æ‰§è¡Œçš„æ“ä½œå£°æ˜åœ¨run()ä¸­

3. åˆ›å»ºThreadç±»çš„å­ç±»çš„å¯¹è±¡

4. é€šè¿‡æ­¤å¯¹è±¡è°ƒç”¨start()ï¼š

   â‘ å¯åŠ¨å½“å‰çº¿ç¨‹

   â‘¡è°ƒç”¨å½“å‰çº¿ç¨‹çš„run()

> è¯´æ˜ä¸¤ä¸ªé—®é¢˜ï¼š
>
> é—®é¢˜ä¸€ï¼šæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå¿…é¡»è°ƒç”¨start()ï¼Œä¸èƒ½è°ƒç”¨run()çš„æ–¹å¼å¯åŠ¨çº¿ç¨‹ã€‚
>
> é—®é¢˜äºŒï¼šå¦‚æœå†å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå¿…é¡»é‡æ–°åˆ›å»ºä¸€ä¸ªThreadå­ç±»çš„å¯¹è±¡ï¼Œè°ƒç”¨æ­¤å¯¹è±¡çš„start()ã€‚

```java
//1. åˆ›å»ºä¸€ä¸ªç»§æ‰¿äºThreadç±»çš„å­ç±»
class MyThread extends Thread {
  //2. é‡å†™Threadç±»çš„run()
  @Override
  public void run() {
    for (int i = 0; i < 100; i++) {
      if(i % 2 == 0){
        System.out.println(Thread.currentThread().getName() + ":" + i);
      }
    }
  }
}


public class ThreadTest {
  public static void main(String[] args) {
    //3. åˆ›å»ºThreadç±»çš„å­ç±»çš„å¯¹è±¡
    MyThread t1 = new MyThread();

    //4.é€šè¿‡æ­¤å¯¹è±¡è°ƒç”¨start():â‘ å¯åŠ¨å½“å‰çº¿ç¨‹ â‘¡ è°ƒç”¨å½“å‰çº¿ç¨‹çš„run()
    t1.start();
    MyThread t2 = new MyThread();
    t2.start();


    //å¦‚ä¸‹æ“ä½œä»ç„¶æ˜¯åœ¨mainçº¿ç¨‹ä¸­æ‰§è¡Œçš„ã€‚
    for (int i = 0; i < 100; i++) {
      if(i % 2 == 0){
        System.out.println(Thread.currentThread().getName() + ":" + i + "***********main()************");
      }
    }
  }

}

```



### 3.2 æ–¹å¼äºŒï¼šå®ç°Runnableæ¥å£çš„æ–¹å¼

1. åˆ›å»ºä¸€ä¸ªå®ç°äº†Runnableæ¥å£çš„ç±»
2. å®ç°ç±»å»å®ç°Runnableæ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼šrun()
3. åˆ›å»ºå®ç°ç±»çš„å¯¹è±¡
4. å°†æ­¤å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°Threadç±»çš„æ„é€ å™¨ä¸­ï¼Œåˆ›å»ºThreadç±»çš„å¯¹è±¡
5. é€šè¿‡Threadç±»çš„å¯¹è±¡è°ƒç”¨start()

```java
//1. åˆ›å»ºä¸€ä¸ªå®ç°äº†Runnableæ¥å£çš„ç±»
class MThread implements Runnable{

  //2. å®ç°ç±»å»å®ç°Runnableä¸­çš„æŠ½è±¡æ–¹æ³•ï¼šrun()
  @Override
  public void run() {
    for (int i = 0; i < 100; i++) {
      if(i % 2 == 0){
        System.out.println(Thread.currentThread().getName() + ":" + i);
      }

    }
  }
}


public class ThreadTest1 {
  public static void main(String[] args) {
    //3. åˆ›å»ºå®ç°ç±»çš„å¯¹è±¡
    MThread mThread = new MThread();
    //4. å°†æ­¤å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°Threadç±»çš„æ„é€ å™¨ä¸­ï¼Œåˆ›å»ºThreadç±»çš„å¯¹è±¡
    Thread t1 = new Thread(mThread);
    t1.setName("çº¿ç¨‹1");
    //5. é€šè¿‡Threadç±»çš„å¯¹è±¡è°ƒç”¨start():â‘  å¯åŠ¨çº¿ç¨‹ â‘¡è°ƒç”¨å½“å‰çº¿ç¨‹çš„run()-->è°ƒç”¨äº†Runnableç±»å‹çš„targetçš„run()
    t1.start();

    //å†å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œéå†100ä»¥å†…çš„å¶æ•°
    Thread t2 = new Thread(mThread);
    t2.setName("çº¿ç¨‹2");
    t2.start();
  }

}
```



### 3.3 ä¸¤ç§æ–¹å¼çš„å¯¹æ¯”

> åœ¨å¼€å‘ä¸­ï¼Œä¼˜å…ˆé€‰æ‹©å®ç°Runnableæ¥å£çš„æ–¹å¼

**åŸå› ï¼š**

1. å®ç°çš„æ–¹å¼æ²¡æœ‰ç±»çš„å•ç»§æ‰¿çš„å±€é™æ€§ã€‚
2. å®ç°çš„æ–¹å¼æ›´é€‚åˆæ¥å¤„ç†å¤šä¸ªå¤šçº¿ç¨‹å…±äº«æ•°æ®çš„æƒ…å†µã€‚

**æ–¹å¼ä¸€å’Œæ–¹å¼äºŒçš„è”ç³»ï¼š**

å®é™…ä¸ŠThreadç±»æœ¬èº«å°±å®ç°äº†Runnableæ¥å£

```java
public class Thread implements Runnable
```

ç›¸åŒç‚¹ï¼šä¸¤ç§æ–¹å¼éƒ½åœ¨éœ€è¦é‡å†™run()æ–¹æ³•ï¼Œå°†çº¿ç¨‹è¦æ‰§è¡Œçš„é€»è¾‘å£°æ˜åœ¨run()ä¸­ã€‚

ç›®å‰ä¸¤ç§æ–¹å¼ï¼Œæƒ³è¦å¯åŠ¨çº¿ç¨‹ï¼Œéƒ½æ˜¯è°ƒç”¨çš„Threadç±»çš„start()ã€‚

## 4. THreadç±»ä¸­çš„å¸¸ç”¨æ–¹æ³•

1. start():å¯åŠ¨å½“å‰çº¿ç¨‹ï¼›è°ƒç”¨å½“å‰çº¿ç¨‹çš„run()
2. run(): é€šå¸¸éœ€è¦é‡å†™Threadç±»ä¸­çš„æ­¤æ–¹æ³•ï¼Œå°†åˆ›å»ºçš„çº¿ç¨‹è¦æ‰§è¡Œçš„æ“ä½œå£°æ˜åœ¨æ­¤æ–¹æ³•ä¸­
3. currentThread():é™æ€æ–¹æ³•ï¼Œè¿”å›æ‰§è¡Œå½“å‰ä»£ç çš„çº¿ç¨‹
4. getName():è·å–å½“å‰çº¿ç¨‹çš„åå­—
5. setName():è®¾ç½®å½“å‰çº¿ç¨‹çš„åå­—
6. yield():é‡Šæ”¾å½“å‰cpuçš„æ‰§è¡Œæƒ
7. join():åœ¨çº¿ç¨‹aä¸­è°ƒç”¨çº¿ç¨‹bçš„join(),æ­¤æ—¶çº¿ç¨‹aå°±è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°çº¿ç¨‹bå®Œå…¨æ‰§è¡Œå®Œä»¥åï¼Œçº¿ç¨‹aæ‰ç»“æŸé˜»å¡çŠ¶æ€ã€‚
8. stop():å·²è¿‡æ—¶ã€‚å½“æ‰§è¡Œæ­¤æ–¹æ³•æ—¶ï¼Œå¼ºåˆ¶ç»“æŸå½“å‰çº¿ç¨‹ã€‚
9. sleep(long millitime):è®©å½“å‰çº¿ç¨‹â€œç¡çœ â€æŒ‡å®šçš„millitimeæ¯«ç§’ã€‚åœ¨æŒ‡å®šçš„millitimeæ¯«ç§’æ—¶é—´å†…ï¼Œå½“å‰çº¿ç¨‹æ˜¯é˜»å¡çŠ¶æ€ã€‚
10. isAlive():åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å­˜æ´»



**çº¿ç¨‹çš„ä¼˜å…ˆçº§åŒ…æ‹¬ï¼š**

* MAX_PRIORITYï¼š10
* MIN _PRIORITYï¼š1
* NORM_PRIORITYï¼š5  -->é»˜è®¤ä¼˜å…ˆçº§



**å¦‚ä½•è·å–å’Œè®¾ç½®å½“å‰çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼š**

* getPriority():è·å–çº¿ç¨‹çš„ä¼˜å…ˆçº§
* setPriority(int p):è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§
> è¯´æ˜ï¼šé«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹è¦æŠ¢å ä½ä¼˜å…ˆçº§çº¿ç¨‹cpuçš„æ‰§è¡Œæƒã€‚ä½†æ˜¯åªæ˜¯ä»æ¦‚ç‡ä¸Šè®²ï¼Œé«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹é«˜æ¦‚ç‡çš„æƒ…å†µä¸‹è¢«æ‰§è¡Œã€‚å¹¶ä¸æ„å‘³ç€åªå½“é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹æ‰§è¡Œå®Œä»¥åï¼Œä½ä¼˜å…ˆçº§çš„çº¿ç¨‹æ‰æ‰§è¡Œã€‚



**è¡¥å……è¯´æ˜:**
çº¿ç¨‹åˆ†ä¸ºå®ˆæŠ¤çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹ä¸¤ç§ã€‚

## 5. Threadçš„ç”Ÿå‘½å‘¨æœŸ

![image-20210313144920000](http://cdn.bearkchan.top/image-20210313144920000.png)

è¯´æ˜ï¼š

1. ç”Ÿå‘½å‘¨æœŸå…³æ³¨ä¸¤ä¸ªæ¦‚å¿µï¼šçŠ¶æ€ã€ç›¸åº”çš„æ–¹æ³•

2. å…³æ³¨ï¼š
   - çŠ¶æ€a-->çŠ¶æ€b:å“ªäº›æ–¹æ³•æ‰§è¡Œäº†ï¼ˆå›è°ƒæ–¹æ³•ï¼‰
   - æŸä¸ªæ–¹æ³•ä¸»åŠ¨è°ƒç”¨ï¼šçŠ¶æ€a-->çŠ¶æ€b
3. é˜»å¡ï¼šä¸´æ—¶çŠ¶æ€ï¼Œä¸å¯ä»¥ä½œä¸ºæœ€ç»ˆçŠ¶æ€

4. æ­»äº¡ï¼šæœ€ç»ˆçŠ¶æ€

## 6. çº¿ç¨‹çš„åŒæ­¥æœºåˆ¶

**èƒŒæ™¯ï¼š**

çª—å£ä¹°ç¥¨è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†é‡ç¥¨ã€é”™ç¥¨çš„æ—¶å€™ï¼Œå³å‡ºç°äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

**é—®é¢˜å‡ºç°çš„åŸå› ï¼š**

å½“æŸä¸ªçº¿ç¨‹æ“ä½œè½¦ç¥¨çš„è¿‡ç¨‹ä¸­ï¼Œå°šæœªæ“ä½œå®Œæˆæ—¶ï¼Œå…¶ä»–çš„çº¿ç¨‹å‚ä¸è¿›æ¥ï¼Œä¹Ÿæ“ä½œäº†è½¦ç¥¨ã€‚

**å¦‚ä½•è§£å†³ï¼š**
å½“ä¸€ä¸ªçº¿ç¨‹aåœ¨æ“ä½œticketçš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½å‚ä¸è¿›æ¥ã€‚ç›´åˆ°çº¿ç¨‹aæ“ä½œå®Œticketæ—¶ï¼Œå…¶ä»–çº¿ç¨‹æ‰å¯ä»¥å¼€å§‹æ“ä½œticketã€‚è¿™ç§æƒ…å†µå³ä½¿çº¿ç¨‹aå‡ºç°äº†é˜»å¡ï¼Œä¹Ÿä¸èƒ½è¢«æ”¹å˜ã€‚

> åœ¨Javaä¸­ï¼Œé€šè¿‡ä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼Œè§£å†³çº¿ç¨‹çš„å®‰å…¨é—®é¢˜ã€‚

### 6.1 æ–¹å¼ä¸€ï¼šåŒæ­¥ä»£ç å—

```java
synchronized(åŒæ­¥ç›‘è§†å™¨){
  // éœ€è¦è¢«åŒæ­¥çš„ä»£ç å—
}
```

è¯´æ˜ï¼š

1. æ“ä½œå…±äº«æ•°æ®çš„ä»£ç ï¼Œå³ä¸ºéœ€è¦è¢«åŒæ­¥çš„ä»£ç ã€‚
2. å…±äº«æ•°æ®ï¼šå¤šä¸ªçº¿ç¨‹å…±åŒæ“ä½œçš„å˜é‡ã€‚
3. åŒæ­¥ç›‘è§†å™¨ï¼šä¿—ç§°ï¼šé”ğŸ”’ï¼Œå¯ä»¥æ˜¯ä»»ä½•ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œä½†æ˜¯è¦æ±‚å¤šä¸ªçº¿ç¨‹å¿…é¡»å…±ç”¨åŒä¸€æŠŠé”ã€‚

> è¡¥å……ï¼š
> * åœ¨å®ç°Runnableæ¥å£åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥**è€ƒè™‘ä½¿ç”¨thiså……å½“åŒæ­¥ç›‘è§†å™¨ã€‚**
> * åœ¨ç»§æ‰¿Threadç±»åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼ä¸­ï¼Œæ…ç”¨thiså……å½“åŒæ­¥ç›‘è§†å™¨ï¼Œ**è€ƒè™‘ä½¿ç”¨å½“å‰ç±»å……å½“åŒæ­¥ç›‘è§†å™¨ã€‚**

```java
class Window1 implements Runnable{

  private int ticket = 100;
  @Override
  public void run() {
    while(true){
      synchronized (this){
        //æ­¤æ—¶çš„this:å”¯ä¸€çš„Window1çš„å¯¹è±¡  
        if (ticket > 0) {
          try {
            Thread.sleep(100);
          } catch (InterruptedException e) {
            e.printStackTrace();
          }
          System.out.println(Thread.currentThread().getName() + ":å–ç¥¨ï¼Œç¥¨å·ä¸ºï¼š" + ticket);
          ticket--;
        } else {
          break;
        }
      }
    }
  }
}


public class WindowTest1 {
  public static void main(String[] args) {
    Window1 w = new Window1();

    Thread t1 = new Thread(w);
    Thread t2 = new Thread(w);
    Thread t3 = new Thread(w);

    t1.setName("çª—å£1");
    t2.setName("çª—å£2");
    t3.setName("çª—å£3");

    t1.start();
    t2.start();
    t3.start();
  }

}
```





### 6.2 æ–¹å¼äºŒï¼šåŒæ­¥æ–¹æ³•

```java
public synchronized void methodName(){
  
}
```

å¦‚æœæ“ä½œå…±äº«æ•°æ®çš„ä»£ç å®Œæ•´çš„å£°æ˜åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¸å¦¨å°†æ­¤æ–¹æ³•å£°æ˜åŒæ­¥çš„ã€‚
1. åŒæ­¥æ–¹æ³•ä»ç„¶æ¶‰åŠåˆ°åŒæ­¥ç›‘è§†å™¨ï¼Œåªæ˜¯ä¸éœ€è¦æˆ‘ä»¬æ˜¾å¼çš„å£°æ˜ã€‚
2. éé™æ€çš„åŒæ­¥æ–¹æ³•ï¼ŒåŒæ­¥ç›‘è§†å™¨æ˜¯ï¼šthis
3. é™æ€çš„åŒæ­¥æ–¹æ³•ï¼ŒåŒæ­¥ç›‘è§†å™¨æ˜¯ï¼šå½“å‰ç±»æœ¬èº«

```java
class Window3 implements Runnable {

  private int ticket = 100;

  @Override
  public void run() {
    while (true) {

      show();
    }
  }

  private synchronized void show(){//åŒæ­¥ç›‘è§†å™¨ï¼šthis
    //synchronized (this){

    if (ticket > 0) {

      try {
        Thread.sleep(100);
      } catch (InterruptedException e) {
        e.printStackTrace();
      }

      System.out.println(Thread.currentThread().getName() + ":å–ç¥¨ï¼Œç¥¨å·ä¸ºï¼š" + ticket);

      ticket--;
    }
    //}
  }
}


public class WindowTest3 {
  public static void main(String[] args) {
    Window3 w = new Window3();

    Thread t1 = new Thread(w);
    Thread t2 = new Thread(w);
    Thread t3 = new Thread(w);

    t1.setName("çª—å£1");
    t2.setName("çª—å£2");
    t3.setName("çª—å£3");

    t1.start();
    t2.start();
    t3.start();
  }

}

```



### 6.3 æ–¹å¼ä¸‰ï¼šLocké”---JDK5.0æ–°å¢

**é¢è¯•é¢˜ï¼šsynchronizedå’ŒLockçš„å¼‚åŒï¼Ÿ**

- ç›¸åŒç‚¹ï¼šäºŒè€…éƒ½å¯ä»¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜
- ä¸åŒç‚¹ï¼š
  - synchronizedæœºåˆ¶åœ¨æ‰§è¡Œå®Œç›¸åº”çš„åŒæ­¥ä»£ç ä»¥åï¼Œè‡ªåŠ¨çš„é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨ã€‚
  - Lockéœ€è¦æ‰‹åŠ¨çš„å¯åŠ¨åŒæ­¥ï¼ˆlock()ï¼‰ï¼ŒåŒæ—¶ç»“æŸåŒæ­¥ä¹Ÿéœ€è¦æ‰‹åŠ¨çš„å®ç°ï¼ˆunlock()ï¼‰

**ä½¿ç”¨çš„å…ˆåé¡ºåºï¼š**

1. Locké”
2. åŒæ­¥ä»£ç å—ï¼ˆå·²æ¥è¿›å…¥æ–¹æ³•ä½“ï¼Œåˆ†é…äº†ç›¸åº”çš„èµ„æºï¼‰
3. åŒæ­¥æ–¹æ³•ï¼ˆåœ¨æ–¹æ³•ä½“å¤–ï¼‰

```java
class Window implements Runnable{

  private int ticket = 100;
  //1.å®ä¾‹åŒ–ReentrantLock
  private ReentrantLock lock = new ReentrantLock();

  @Override
  public void run() {
    while(true){
      try{

        //2.è°ƒç”¨é”å®šæ–¹æ³•lock()
        lock.lock();

        if(ticket > 0){

          try {
            Thread.sleep(100);
          } catch (InterruptedException e) {
            e.printStackTrace();
          }

          System.out.println(Thread.currentThread().getName() + "ï¼šå”®ç¥¨ï¼Œç¥¨å·ä¸ºï¼š" + ticket);
          ticket--;
        }else{
          break;
        }
      }finally {
        //3.è°ƒç”¨è§£é”æ–¹æ³•ï¼šunlock()
        lock.unlock();
      }

    }
  }
}

public class LockTest {
  public static void main(String[] args) {
    Window w = new Window();

    Thread t1 = new Thread(w);
    Thread t2 = new Thread(w);
    Thread t3 = new Thread(w);

    t1.setName("çª—å£1");
    t2.setName("çª—å£2");
    t3.setName("çª—å£3");

    t1.start();
    t2.start();
    t3.start();
  }
}

```

### 6.1 çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ï¼ˆæ‡’æ±‰å¼ï¼‰

ä½¿ç”¨åŒæ­¥æœºåˆ¶å°†å•ä¾‹æ¨¡å¼ä¸­çš„æ‡’æ±‰å¼æ”¹å†™ä¸ºçº¿ç¨‹å®‰å…¨çš„ã€‚

```java
class Bank{

  private Bank(){}

  private static Bank instance = null;

  public static Bank getInstance(){
    //æ–¹å¼ä¸€ï¼šæ•ˆç‡ç¨å·®
    //        synchronized (Bank.class) {
    //            if(instance == null){
    //
    //                instance = new Bank();
    //            }
    //            return instance;
    //        }
    //æ–¹å¼äºŒï¼šæ•ˆç‡æ›´é«˜
    if(instance == null){

      synchronized (Bank.class) {
        if(instance == null){

          instance = new Bank();
        }

      }
    }
    return instance;
  }

}
```



### 6.2 æ­»é”é—®é¢˜

**ä»€ä¹ˆå«æ­»é”ï¼Ÿ**
ä¸åŒçš„çº¿ç¨‹åˆ†åˆ«å ç”¨å¯¹æ–¹éœ€è¦çš„åŒæ­¥èµ„æºä¸æ”¾å¼ƒï¼Œéƒ½åœ¨ç­‰å¾…å¯¹æ–¹æ”¾å¼ƒè‡ªå·±éœ€è¦çš„åŒæ­¥èµ„æºï¼Œå°±å½¢æˆäº†çº¿ç¨‹çš„æ­»é”
- å‡ºç°æ­»é”åï¼Œä¸ä¼šå‡ºç°å¼‚å¸¸ï¼Œä¸ä¼šå‡ºç°æç¤ºï¼Œåªæ˜¯æ‰€çš„çº¿ç¨‹éƒ½å¤„äºé˜»å¡çŠ¶æ€ï¼Œæ— æ³•ç»§ç»­
- æˆ‘ä»¬ä½¿ç”¨åŒæ­¥æ—¶ï¼Œè¦é¿å…å‡ºç°æ­»é”ã€‚

```java
public static void main(String[] args) {

  StringBuffer s1 = new StringBuffer();
  StringBuffer s2 = new StringBuffer();


  new Thread(){
    @Override
    public void run() {

      synchronized (s1){

        s1.append("a");
        s2.append("1");

        try {
          Thread.sleep(100);
        } catch (InterruptedException e) {
          e.printStackTrace();
        }


        synchronized (s2){
          s1.append("b");
          s2.append("2");

          System.out.println(s1);
          System.out.println(s2);
        }


      }

    }
  }.start();


  new Thread(new Runnable() {
    @Override
    public void run() {
      synchronized (s2){

        s1.append("c");
        s2.append("3");

        try {
          Thread.sleep(100);
        } catch (InterruptedException e) {
          e.printStackTrace();
        }

        synchronized (s1){
          s1.append("d");
          s2.append("4");

          System.out.println(s1);
          System.out.println(s2);
        }
      }
    }
  }).start();


}
```



## 7. çº¿ç¨‹é€šä¿¡

### 7.1 çº¿ç¨‹é€šä¿¡æ¶‰åŠåˆ°çš„ä¸‰ä¸ªæ–¹æ³•

- wait()ï¼šä¸€æ—¦æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹å°±è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå¹¶é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨ã€‚
- notify()ï¼šä¸€æ—¦æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œå°±ä¼šå”¤é†’è¢«waitçš„ä¸€ä¸ªçº¿ç¨‹ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹è¢«waitï¼Œå°±å”¤é†’ä¼˜å…ˆçº§é«˜çš„é‚£ä¸ªã€‚
- notifyAll()ï¼šä¸€æ—¦æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œå°±ä¼šå”¤é†’æ‰€æœ‰è¢«waitçš„çº¿ç¨‹ã€‚

è¯´æ˜ï¼š
1. wait()ï¼Œnotify()ï¼ŒnotifyAll()ä¸‰ä¸ªæ–¹æ³•å¿…é¡»ä½¿ç”¨åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­ã€‚
2. wait()ï¼Œnotify()ï¼ŒnotifyAll()ä¸‰ä¸ªæ–¹æ³•çš„è°ƒç”¨è€…å¿…é¡»æ˜¯åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­çš„åŒæ­¥ç›‘è§†å™¨ã€‚å¦åˆ™ï¼Œä¼šå‡ºç°IllegalMonitorStateExceptionå¼‚å¸¸
3. wait()ï¼Œnotify()ï¼ŒnotifyAll()ä¸‰ä¸ªæ–¹æ³•æ˜¯å®šä¹‰åœ¨java.lang.Objectç±»ä¸­ã€‚

### 7.2 sleep()å’Œwait()çš„å¼‚åŒ
- ç›¸åŒç‚¹ï¼šä¸€æ—¦æ‰§è¡Œæ–¹æ³•ï¼Œéƒ½å¯ä»¥ä½¿å¾—å½“å‰çš„çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚
- ä¸åŒç‚¹ï¼š
  1. ä¸¤ä¸ªæ–¹æ³•å£°æ˜çš„ä½ç½®ä¸åŒï¼šThreadç±»ä¸­å£°æ˜sleep() , Objectç±»ä¸­å£°æ˜wait()

  2. è°ƒç”¨çš„è¦æ±‚ä¸åŒï¼šsleep()å¯ä»¥åœ¨ä»»ä½•éœ€è¦çš„åœºæ™¯ä¸‹è°ƒç”¨ã€‚ wait()å¿…é¡»ä½¿ç”¨åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­

  3. å…³äºæ˜¯å¦é‡Šæ”¾åŒæ­¥ç›‘è§†å™¨ï¼šå¦‚æœä¸¤ä¸ªæ–¹æ³•éƒ½ä½¿ç”¨åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­ï¼Œsleep()ä¸ä¼šé‡Šæ”¾é”ï¼Œwait()ä¼šé‡Šæ”¾é”ã€‚

### 7.3 é‡Šæ”¾é”çš„æ“ä½œ

![image-20210313151930632](http://cdn.bearkchan.top/image-20210313151930632.png)

### 7.4 ä¸ä¼šé‡Šæ”¾é”çš„æ“ä½œ

![image-20210313151949265](http://cdn.bearkchan.top/image-20210313151949265.png)

## 8. JDK5.0æ–°å¢çº¿ç¨‹åˆ›å»ºçš„æ–¹å¼

### 8.1 æ–°å¢æ–¹å¼ä¸€ï¼šå®ç°Callableæ¥å£

1. åˆ›å»ºä¸€ä¸ªå®ç°Callableçš„å®ç°ç±»
2. å®ç°callæ–¹æ³•ï¼Œå°†æ­¤çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„æ“ä½œå£°æ˜åœ¨call()ä¸­
3. åˆ›å»ºCallableæ¥å£å®ç°ç±»çš„å¯¹è±¡
4. å°†æ­¤Callableæ¥å£å®ç°ç±»çš„å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°FutureTaskæ„é€ å™¨ä¸­ï¼Œåˆ›å»ºFutureTaskçš„å¯¹è±¡
5. å°†FutureTaskçš„å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°Threadç±»çš„æ„é€ å™¨ä¸­ï¼Œåˆ›å»ºThreadå¯¹è±¡ï¼Œå¹¶è°ƒç”¨start()
6. è·å–Callableä¸­callæ–¹æ³•çš„è¿”å›å€¼

```java
//1.åˆ›å»ºä¸€ä¸ªå®ç°Callableçš„å®ç°ç±»
class NumThread implements Callable{
   //2.å®ç°callæ–¹æ³•ï¼Œå°†æ­¤çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„æ“ä½œå£°æ˜åœ¨call()ä¸­
   @Override
   public Object call() throws Exception {
       int sum = 0;
       for (int i = 1; i <= 100; i++) {
           if(i % 2 == 0){
               System.out.println(i);
               sum += i;
           }
       }
       return sum;
   }
}


public class ThreadNew {
   public static void main(String[] args) {
       //3.åˆ›å»ºCallableæ¥å£å®ç°ç±»çš„å¯¹è±¡
       NumThread numThread = new NumThread();
       //4.å°†æ­¤Callableæ¥å£å®ç°ç±»çš„å¯¹è±¡ä½œä¸ºä¼ é€’åˆ°FutureTaskæ„é€ å™¨ä¸­ï¼Œåˆ›å»ºFutureTaskçš„å¯¹è±¡
       FutureTask futureTask = new FutureTask(numThread);
       //5.å°†FutureTaskçš„å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’åˆ°Threadç±»çš„æ„é€ å™¨ä¸­ï¼Œåˆ›å»ºThreadå¯¹è±¡ï¼Œå¹¶è°ƒç”¨start()
       new Thread(futureTask).start();

       try {
           //6.è·å–Callableä¸­callæ–¹æ³•çš„è¿”å›å€¼
           //get()è¿”å›å€¼å³ä¸ºFutureTaskæ„é€ å™¨å‚æ•°Callableå®ç°ç±»é‡å†™çš„call()çš„è¿”å›å€¼ã€‚
           Object sum = futureTask.get();
           System.out.println("æ€»å’Œä¸ºï¼š" + sum);
       } catch (InterruptedException e) {
           e.printStackTrace();
       } catch (ExecutionException e) {
           e.printStackTrace();
       }
   }

}
```

> è¯´æ˜ï¼šå¦‚ä½•ç†è§£å®ç°Callableæ¥å£çš„æ–¹å¼åˆ›å»ºå¤šçº¿ç¨‹æ¯”å®ç°Runnableæ¥å£åˆ›å»ºå¤šçº¿ç¨‹æ–¹å¼å¼ºå¤§ï¼Ÿ
>1. call()å¯ä»¥è¿”å›å€¼çš„ã€‚
>2. call()å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¢«å¤–é¢çš„æ“ä½œæ•è·ï¼Œè·å–å¼‚å¸¸çš„ä¿¡æ¯
>3. Callableæ˜¯æ”¯æŒæ³›å‹çš„



### 8.2 æ–°å¢æ–¹å¼äºŒï¼šä½¿ç”¨çº¿ç¨‹æ± çš„æ–¹å¼

```java
class NumberThread implements Runnable{

  @Override
  public void run() {
    for(int i = 0;i <= 100;i++){
      if(i % 2 == 0){
        System.out.println(Thread.currentThread().getName() + ": " + i);
      }
    }
  }
}

class NumberThread1 implements Runnable{

  @Override
  public void run() {
    for(int i = 0;i <= 100;i++){
      if(i % 2 != 0){
        System.out.println(Thread.currentThread().getName() + ": " + i);
      }
    }
  }
}

public class ThreadPool {

  public static void main(String[] args) {
    //1. æä¾›æŒ‡å®šçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± 
    ExecutorService service = Executors.newFixedThreadPool(10);
    ThreadPoolExecutor service1 = (ThreadPoolExecutor) service;
    //è®¾ç½®çº¿ç¨‹æ± çš„å±æ€§
    //        System.out.println(service.getClass());
    //        service1.setCorePoolSize(15);
    //        service1.setKeepAliveTime();


    //2.æ‰§è¡ŒæŒ‡å®šçš„çº¿ç¨‹çš„æ“ä½œã€‚éœ€è¦æä¾›å®ç°Runnableæ¥å£æˆ–Callableæ¥å£å®ç°ç±»çš„å¯¹è±¡
    service.execute(new NumberThread());//é€‚åˆé€‚ç”¨äºRunnable
    service.execute(new NumberThread1());//é€‚åˆé€‚ç”¨äºRunnable

    //        service.submit(Callable callable);//é€‚åˆä½¿ç”¨äºCallable
    //3.å…³é—­è¿æ¥æ± 
    service.shutdown();
  }

}
```

è¯´æ˜ï¼šå¥½å¤„æœ‰ï¼š

1. æé«˜å“åº”é€Ÿåº¦ï¼ˆå‡å°‘äº†åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶é—´ï¼‰

2. é™ä½èµ„æºæ¶ˆè€—ï¼ˆé‡å¤åˆ©ç”¨çº¿ç¨‹æ± ä¸­çº¿ç¨‹ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½åˆ›å»ºï¼‰

3. ä¾¿äºçº¿ç¨‹ç®¡ç†
   - corePoolSizeï¼šæ ¸å¿ƒæ± çš„å¤§å°
   - maximumPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•°
   - keepAliveTimeï¼šçº¿ç¨‹æ²¡ä»»åŠ¡æ—¶æœ€å¤šä¿æŒå¤šé•¿æ—¶é—´åä¼šç»ˆæ­¢